<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TrackMate | Monthly Budget Setter</title>
  <link rel="stylesheet" href="../src/css/budget.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="logo-container">
      <img src="../assets/trackmate_logo.png" alt="TrackMate Logo" class="nav-logo" />
      <h1 class="nav-title">TrackMate</h1>
    </div>
    <button id="backBtn" class="back-btn">Back to Dashboard</button>
  </header>

  <main class="main-container">
    <h2 class="title">Set Your Monthly Budget</h2>

    <!-- Budget Form -->
    <section class="glass-card">
      <form id="budgetForm" class="budget-form">
        <label for="budgetMonth">Select Month:</label>
        <select id="budgetMonth" required>
          <option value="" disabled selected>Select a month</option>
          <option>January</option><option>February</option><option>March</option>
          <option>April</option><option>May</option><option>June</option>
          <option>July</option><option>August</option><option>September</option>
          <option>October</option><option>November</option><option>December</option>
        </select>

        <label for="budgetAmount">Enter Budget Amount (₹):</label>
        <input type="number" id="budgetAmount" placeholder="e.g. 15000" required />

        <button type="submit" class="save-btn">Set Budget</button>
      </form>
    </section>

    <!-- Budget List -->
    <section class="glass-card budget-list-container">
      <div class="list-header">
        <h3 class="section-heading">Your Saved Monthly Budgets</h3>
        <button id="clearAllBtn" class="clear-all-btn">Clear All</button>
      </div>
      <ul id="savedBudgets" class="budget-list">
        <li>No budgets set yet.</li>
      </ul>
    </section>
  </main>

  <script>
    const budgetForm = document.getElementById("budgetForm");
    const monthSelect = document.getElementById("budgetMonth");
    const amountInput = document.getElementById("budgetAmount");
    const budgetList = document.getElementById("savedBudgets");
    const clearAllBtn = document.getElementById("clearAllBtn");

    function loadBudgets() {
      const saved = JSON.parse(localStorage.getItem("trackmateBudgets")) || {};
      budgetList.innerHTML = "";

      if (Object.keys(saved).length === 0) {
        budgetList.innerHTML = "<li>No budgets set yet.</li>";
        return;
      }

      Object.entries(saved).forEach(([month, amount]) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <span><strong>${month}</strong> - ₹${amount}</span>
          <span class="icon-actions">
            <i class="fas fa-edit edit-icon" title="Edit" data-month="${month}"></i>
            <i class="fas fa-trash delete-icon" title="Delete" data-month="${month}"></i>
          </span>
        `;
        budgetList.appendChild(li);
      });

      addIconListeners();
    }

    function addIconListeners() {
      document.querySelectorAll(".edit-icon").forEach(icon => {
        icon.addEventListener("click", () => {
          const month = icon.dataset.month;
          const saved = JSON.parse(localStorage.getItem("trackmateBudgets")) || {};
          const amount = saved[month];

          monthSelect.value = month;
          amountInput.value = amount;
        });
      });

      document.querySelectorAll(".delete-icon").forEach(icon => {
        icon.addEventListener("click", () => {
          const month = icon.dataset.month;
          if (confirm(`Delete budget for ${month}?`)) {
            const saved = JSON.parse(localStorage.getItem("trackmateBudgets")) || {};
            delete saved[month];
            localStorage.setItem("trackmateBudgets", JSON.stringify(saved));
            loadBudgets();
          }
        });
      });
    }

    budgetForm.addEventListener("submit", function (e) {
      e.preventDefault();
      const month = monthSelect.value;
      const amount = amountInput.value;

      if (!month || !amount || isNaN(amount) || amount <= 0) return;

      const saved = JSON.parse(localStorage.getItem("trackmateBudgets")) || {};
      saved[month] = amount;

      localStorage.setItem("trackmateBudgets", JSON.stringify(saved));
      loadBudgets();
      budgetForm.reset();
    });

    clearAllBtn.addEventListener("click", function () {
      if (confirm("Are you sure you want to delete all budgets?")) {
        localStorage.removeItem("trackmateBudgets");
        loadBudgets();
      }
    });

    document.getElementById("backBtn").addEventListener("click", () => {
      window.location.href = "dashboard.html";
    });

    window.addEventListener("DOMContentLoaded", loadBudgets);
  </script>
</body>
</html>
